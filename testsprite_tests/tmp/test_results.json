[
  {
    "projectId": "18fea9cf-a48a-41cf-920c-54c7a85dc37f",
    "testId": "62aabcb5-7522-45e9-8e3e-f4d217b94c99",
    "userId": "34987418-10f1-703d-2598-f1c3b2cef297",
    "title": "TC001-health endpoint returns service status",
    "description": "Verify that the GET /health endpoint returns a 200 status with a JSON body containing the service status as 'ok', service name as 'semantic-cache', and the current version string.",
    "code": "import requests\n\ndef test_health_endpoint_returns_service_status():\n    base_url = \"http://localhost:8000\"\n    url = f\"{base_url}/health\"\n    timeout = 30\n    try:\n        response = requests.get(url, timeout=timeout)\n        response.raise_for_status()\n    except requests.RequestException as e:\n        assert False, f\"Request to {url} failed: {e}\"\n\n    assert response.status_code == 200, f\"Expected status code 200, got {response.status_code}\"\n    try:\n        data = response.json()\n    except ValueError:\n        assert False, \"Response is not valid JSON\"\n\n    assert isinstance(data, dict), \"Response JSON is not an object\"\n    assert data.get(\"status\") == \"ok\", f\"Expected 'status' to be 'ok', got {data.get('status')}\"\n    assert data.get(\"service\") == \"semantic-cache\", f\"Expected 'service' to be 'semantic-cache', got {data.get('service')}\"\n    version = data.get(\"version\")\n    assert isinstance(version, str) and len(version) > 0, f\"Expected non-empty 'version' string, got {version}\"\n\ntest_health_endpoint_returns_service_status()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-01T02:30:38.116Z",
    "modified": "2025-11-01T02:30:49.070Z"
  },
  {
    "projectId": "18fea9cf-a48a-41cf-920c-54c7a85dc37f",
    "testId": "0c1d84ab-98bd-4750-977d-65c959d0182c",
    "userId": "34987418-10f1-703d-2598-f1c3b2cef297",
    "title": "TC002-metrics endpoint returns cache_performance_metrics",
    "description": "Verify that the GET /metrics endpoint returns cache performance metrics for the authenticated tenant, including requests, hits, semantic_hits, misses, hit_ratio, sim_threshold, entries, p50_latency_ms, and p95_latency_ms.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nAPI_KEY = \"sc-test-local\"  # Replace with a valid tenant-scoped API key\n\ndef test_metrics_endpoint_returns_cache_performance_metrics():\n    url = f\"{BASE_URL}/metrics\"\n    headers = {\n        \"Authorization\": f\"Bearer {API_KEY}\"\n    }\n    try:\n        response = requests.get(url, headers=headers, timeout=30)\n        assert response.status_code == 200, f\"Expected status code 200, got {response.status_code}\"\n        json_data = response.json()\n\n        # Validate presence and types of required fields\n        expected_fields = {\n            \"tenant\": str,\n            \"requests\": int,\n            \"hits\": int,\n            \"semantic_hits\": int,\n            \"misses\": int,\n            \"hit_ratio\": (int, float),\n            \"sim_threshold\": (int, float),\n            \"entries\": int,\n            \"p50_latency_ms\": (int, float),\n            \"p95_latency_ms\": (int, float),\n        }\n\n        for field, field_type in expected_fields.items():\n            assert field in json_data, f\"Missing field '{field}' in response\"\n            assert isinstance(json_data[field], field_type), (\n                f\"Field '{field}' expected type {field_type} but got {type(json_data[field])}\"\n            )\n\n        # Additional sanity checks on metric values (non-negative)\n        assert json_data[\"requests\"] >= 0, \"requests should be non-negative\"\n        assert json_data[\"hits\"] >= 0, \"hits should be non-negative\"\n        assert json_data[\"semantic_hits\"] >= 0, \"semantic_hits should be non-negative\"\n        assert json_data[\"misses\"] >= 0, \"misses should be non-negative\"\n        assert 0.0 <= json_data[\"hit_ratio\"] <= 1.0, \"hit_ratio should be between 0 and 1\"\n        assert 0.0 <= json_data[\"sim_threshold\"] <= 1.0, \"sim_threshold should be between 0 and 1\"\n        assert json_data[\"entries\"] >= 0, \"entries should be non-negative\"\n        assert json_data[\"p50_latency_ms\"] >= 0, \"p50_latency_ms should be non-negative\"\n        assert json_data[\"p95_latency_ms\"] >= 0, \"p95_latency_ms should be non-negative\"\n\n    except requests.RequestException as e:\n        assert False, f\"Request to /metrics endpoint failed: {e}\"\n\ntest_metrics_endpoint_returns_cache_performance_metrics()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-01T02:30:38.123Z",
    "modified": "2025-11-01T02:30:49.277Z"
  },
  {
    "projectId": "18fea9cf-a48a-41cf-920c-54c7a85dc37f",
    "testId": "28c78789-d29d-4d3e-af62-14b93f6d4f31",
    "userId": "34987418-10f1-703d-2598-f1c3b2cef297",
    "title": "TC003-query endpoint returns cached_or_fresh_answer",
    "description": "Verify that the GET /query endpoint returns a valid answer with meta information specifying hit type (exact, semantic, miss), similarity score, latency in ms, and caching strategy, based on the prompt and model parameters.",
    "code": "import requests\nfrom requests.exceptions import RequestException\n\nBASE_URL = \"http://localhost:8000\"\nAPI_KEY = \"sc-test-local\"  # Use a valid tenant-scoped API key here\nTIMEOUT = 30\n\ndef test_query_endpoint_returns_cached_or_fresh_answer():\n    url = f\"{BASE_URL}/query\"\n    headers = {\n        \"Authorization\": f\"Bearer {API_KEY}\"\n    }\n    params = {\n        \"prompt\": \"What is Python?\",\n        \"model\": \"gpt-4o-mini\"\n    }\n    try:\n        response = requests.get(url, headers=headers, params=params, timeout=TIMEOUT)\n        assert response.status_code == 200, f\"Expected status code 200, got {response.status_code}\"\n        data = response.json()\n        assert \"answer\" in data, \"Response JSON missing 'answer'\"\n        assert isinstance(data[\"answer\"], str) and data[\"answer\"], \"'answer' must be a non-empty string\"\n        assert \"meta\" in data, \"Response JSON missing 'meta'\"\n        meta = data[\"meta\"]\n        # Validate hit type\n        assert \"hit\" in meta, \"'meta' missing 'hit'\"\n        assert meta[\"hit\"] in (\"exact\", \"semantic\", \"miss\"), f\"Unexpected hit value: {meta['hit']}\"\n        # Validate similarity score\n        assert \"similarity\" in meta, \"'meta' missing 'similarity'\"\n        similarity = meta[\"similarity\"]\n        assert isinstance(similarity, (int, float)), \"'similarity' must be a number\"\n        assert 0.0 <= similarity <= 1.0, \"'similarity' must be between 0 and 1\"\n        # Validate latency_ms\n        assert \"latency_ms\" in meta, \"'meta' missing 'latency_ms'\"\n        latency = meta[\"latency_ms\"]\n        assert isinstance(latency, (int, float)), \"'latency_ms' must be a number\"\n        assert latency >= 0, \"'latency_ms' must be non-negative\"\n        # Validate strategy\n        assert \"strategy\" in meta, \"'meta' missing 'strategy'\"\n        assert isinstance(meta[\"strategy\"], str) and meta[\"strategy\"], \"'strategy' must be a non-empty string\"\n    except RequestException as e:\n        assert False, f\"Request failed: {e}\"\n\ntest_query_endpoint_returns_cached_or_fresh_answer()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-01T02:30:38.129Z",
    "modified": "2025-11-01T02:30:58.100Z"
  },
  {
    "projectId": "18fea9cf-a48a-41cf-920c-54c7a85dc37f",
    "testId": "434179d2-3038-4c8b-b95e-4b60ffdd4986",
    "userId": "34987418-10f1-703d-2598-f1c3b2cef297",
    "title": "TC004-chat_completions_endpoint_returns_cached_or_fresh_response",
    "description": "Verify that the POST /v1/chat/completions endpoint returns a chat completion response with id, object, created timestamp, model, choices, usage, and meta information, supporting semantic caching and correct authentication.",
    "code": "import requests\nimport uuid\n\nBASE_URL = \"http://localhost:8000\"\nAPI_KEY = \"sc-test-local\"  # Replace with a valid tenant-scoped API key if needed\n\ndef chat_completions_endpoint_returns_cached_or_fresh_response():\n    url = f\"{BASE_URL}/v1/chat/completions\"\n    headers = {\n        \"Authorization\": f\"Bearer {API_KEY}\",\n        \"Content-Type\": \"application/json\"\n    }\n    payload = {\n        \"model\": \"gpt-4o-mini\",\n        \"messages\": [\n            {\n                \"role\": \"user\",\n                \"content\": f\"Test message for chat completion {uuid.uuid4()}\"\n            }\n        ],\n        \"temperature\": 0.2,\n        \"ttl_seconds\": 604800\n    }\n    try:\n        response = requests.post(url, json=payload, headers=headers, timeout=30)\n        assert response.status_code == 200, f\"Expected status code 200, got {response.status_code}\"\n        resp_json = response.json()\n\n        # Assert required fields in response\n        assert isinstance(resp_json.get(\"id\"), str) and len(resp_json[\"id\"]) > 0, \"Missing or invalid 'id'\"\n        assert isinstance(resp_json.get(\"object\"), str) and len(resp_json[\"object\"]) > 0, \"Missing or invalid 'object'\"\n        assert isinstance(resp_json.get(\"created\"), int), \"Missing or invalid 'created' timestamp\"\n        assert isinstance(resp_json.get(\"model\"), str) and len(resp_json[\"model\"]) > 0, \"Missing or invalid 'model'\"\n        assert isinstance(resp_json.get(\"choices\"), list) and len(resp_json[\"choices\"]) > 0, \"Missing or invalid 'choices'\"\n        assert isinstance(resp_json.get(\"usage\"), dict), \"Missing or invalid 'usage'\"\n        assert isinstance(resp_json.get(\"meta\"), dict), \"Missing or invalid 'meta'\"\n\n        # Validate meta content keys for semantic caching info\n        meta = resp_json[\"meta\"]\n        # Expected meta keys may include hit type, similarity, latency etc. Check existence at least.\n        assert any(hit_type in meta.get(\"hit\", \"\") for hit_type in [\"exact\", \"semantic\", \"miss\"]), \"'meta.hit' value invalid\"\n        # similarity may be float or absent, optional existence check\n        if \"similarity\" in meta:\n            assert isinstance(meta[\"similarity\"], (float, int)), \"'meta.similarity' should be a number\"\n        if \"latency_ms\" in meta:\n            assert isinstance(meta[\"latency_ms\"], (float, int)), \"'meta.latency_ms' should be a number\"\n\n    except (requests.RequestException, AssertionError) as e:\n        raise AssertionError(f\"Test failed: {str(e)}\")\n\nchat_completions_endpoint_returns_cached_or_fresh_response()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-01T02:30:38.135Z",
    "modified": "2025-11-01T02:31:00.957Z"
  }
]
