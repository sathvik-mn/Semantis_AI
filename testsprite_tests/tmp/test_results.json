[
  {
    "projectId": "5d27465a-0fb1-40c9-b162-b5833a7403d9",
    "testId": "d20f51f0-4b46-4299-9f57-d5618f67671a",
    "userId": "34987418-10f1-703d-2598-f1c3b2cef297",
    "title": "TC001-health endpoint returns service status",
    "description": "Verify that the /health GET endpoint returns a 200 status with a JSON body containing the service status, service name, and version.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nTIMEOUT = 30\nAPI_KEY = \"sc-test-local\"  # Example tenant API key for authentication\n\ndef test_health_endpoint_returns_service_status():\n    url = f\"{BASE_URL}/health\"\n    headers = {\n        \"Authorization\": f\"Bearer {API_KEY}\"\n    }\n    try:\n        response = requests.get(url, headers=headers, timeout=TIMEOUT)\n    except requests.RequestException as e:\n        assert False, f\"Request to /health failed: {e}\"\n\n    assert response.status_code == 200, f\"Expected status 200, got {response.status_code}\"\n\n    try:\n        data = response.json()\n    except ValueError:\n        assert False, \"Response is not valid JSON\"\n\n    # Validate keys and types\n    required_keys = [\"status\", \"service\", \"version\"]\n    for key in required_keys:\n        assert key in data, f\"Response JSON missing key: {key}\"\n        assert isinstance(data[key], str), f\"Key '{key}' should be of type str\"\n\n    # Optional deeper checks against expected values\n    assert data[\"status\"].lower() == \"ok\", f\"Expected 'status' to be 'ok', got {data['status']}\"\n    assert data[\"service\"].lower() == \"semantic-cache\", f\"Expected 'service' to be 'semantic-cache', got {data['service']}\"\n\ntest_health_endpoint_returns_service_status()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-09T01:14:05.492Z",
    "modified": "2025-11-09T01:14:16.102Z"
  },
  {
    "projectId": "5d27465a-0fb1-40c9-b162-b5833a7403d9",
    "testId": "726b5e2b-0faa-45b4-9162-fe2e8792d7e3",
    "userId": "34987418-10f1-703d-2598-f1c3b2cef297",
    "title": "TC002-metrics endpoint returns cache_performance_metrics",
    "description": "Verify that the /metrics GET endpoint returns cache performance metrics for the authenticated tenant, including requests, hits, semantic hits, misses, hit ratio, similarity threshold, entries, and latency percentiles.",
    "code": "import requests\n\nbase_url = \"http://localhost:8000\"\napi_key = \"sc-test-local-authkey\"  # Replace with a valid tenant API key\n\ndef test_metrics_endpoint_returns_cache_performance_metrics():\n    url = f\"{base_url}/metrics\"\n    headers = {\n        \"Authorization\": f\"Bearer {api_key}\",\n        \"Accept\": \"application/json\"\n    }\n    try:\n        response = requests.get(url, headers=headers, timeout=30)\n        assert response.status_code == 200, f\"Expected status code 200, got {response.status_code}\"\n        data = response.json()\n        # Validate presence and types of expected fields\n        expected_fields = {\n            \"tenant\": str,\n            \"requests\": int,\n            \"hits\": int,\n            \"semantic_hits\": int,\n            \"misses\": int,\n            \"hit_ratio\": (float, int),\n            \"sim_threshold\": (float, int),\n            \"entries\": int,\n            \"p50_latency_ms\": (float, int),\n            \"p95_latency_ms\": (float, int),\n        }\n        for field, field_type in expected_fields.items():\n            assert field in data, f\"Missing field '{field}' in response\"\n            assert isinstance(data[field], field_type), f\"Field '{field}' expected type {field_type}, got {type(data[field])}\"\n    except requests.exceptions.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n\ntest_metrics_endpoint_returns_cache_performance_metrics()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-09T01:14:05.499Z",
    "modified": "2025-11-09T01:14:29.977Z"
  },
  {
    "projectId": "5d27465a-0fb1-40c9-b162-b5833a7403d9",
    "testId": "418efe19-ef4c-45a2-b441-f7648963607c",
    "userId": "34987418-10f1-703d-2598-f1c3b2cef297",
    "title": "TC003-simple_query_endpoint_returns_semantic_cache_response",
    "description": "Verify that the /query GET endpoint returns a response with answer, meta information including hit type (exact, semantic, miss), similarity score, latency, and strategy for a given prompt and optional model.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nAPI_KEY = \"sc-test-local\"\nHEADERS = {\n    \"Authorization\": f\"Bearer {API_KEY}\"\n}\nTIMEOUT = 30\n\ndef test_simple_query_endpoint_returns_semantic_cache_response():\n    prompt = \"What is Python?\"\n    params = {\"prompt\": prompt, \"model\": \"gpt-4o-mini\"}\n\n    try:\n        response = requests.get(f\"{BASE_URL}/query\", headers=HEADERS, params=params, timeout=TIMEOUT)\n        response.raise_for_status()\n    except requests.RequestException as e:\n        assert False, f\"Request to /query failed: {e}\"\n\n    json_data = response.json()\n    # Validate top-level keys\n    assert \"answer\" in json_data, \"Response missing 'answer'\"\n    assert \"meta\" in json_data, \"Response missing 'meta'\"\n    meta = json_data[\"meta\"]\n    # Validate meta contents\n    assert isinstance(meta, dict), \"'meta' should be an object\"\n    assert \"hit\" in meta, \"'meta' missing 'hit'\"\n    assert meta[\"hit\"] in (\"exact\", \"semantic\", \"miss\"), \"'hit' must be 'exact', 'semantic', or 'miss'\"\n    assert \"similarity\" in meta, \"'meta' missing 'similarity'\"\n    assert isinstance(meta[\"similarity\"], (float, int)), \"'similarity' must be a number\"\n    assert \"latency_ms\" in meta, \"'meta' missing 'latency_ms'\"\n    assert isinstance(meta[\"latency_ms\"], (float, int)), \"'latency_ms' must be a number\"\n    assert \"strategy\" in meta, \"'meta' missing 'strategy'\"\n    assert isinstance(meta[\"strategy\"], str), \"'strategy' must be a string\"\n\n    # Optional: Check metrics key presence (type object) if present\n    if \"metrics\" in json_data:\n        assert isinstance(json_data[\"metrics\"], dict), \"'metrics' should be an object if present\"\n\ntest_simple_query_endpoint_returns_semantic_cache_response()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-09T01:14:05.505Z",
    "modified": "2025-11-09T01:14:29.770Z"
  },
  {
    "projectId": "5d27465a-0fb1-40c9-b162-b5833a7403d9",
    "testId": "3ec1e110-077b-43b5-9065-a9da64ac0c4c",
    "userId": "34987418-10f1-703d-2598-f1c3b2cef297",
    "title": "TC004-chat_completions_endpoint_returns_openai_compatible_response",
    "description": "Verify that the /v1/chat/completions POST endpoint returns a valid OpenAI-compatible chat completion response with id, object, created timestamp, model, choices, usage, and meta information.",
    "code": "import requests\n\ndef test_chat_completions_endpoint_returns_openai_compatible_response():\n    base_url = \"http://localhost:8000\"\n    endpoint = \"/v1/chat/completions\"\n    url = base_url + endpoint\n\n    api_key = \"sc-test-local\"  # Example tenant API key; replace with a valid key if needed\n    headers = {\n        \"Authorization\": f\"Bearer {api_key}\",\n        \"Content-Type\": \"application/json\"\n    }\n\n    payload = {\n        \"model\": \"gpt-4o-mini\",\n        \"messages\": [\n            {\"role\": \"user\", \"content\": \"Hello, how are you?\"}\n        ],\n        \"temperature\": 0.2,\n        \"ttl_seconds\": 600\n    }\n\n    try:\n        response = requests.post(url, headers=headers, json=payload, timeout=30)\n        assert response.status_code == 200, f\"Expected status code 200, got {response.status_code}\"\n        data = response.json()\n\n        assert isinstance(data, dict), \"Response is not a JSON object\"\n\n        # Validate required top-level fields\n        for field in [\"id\", \"object\", \"created\", \"model\", \"choices\", \"usage\", \"meta\"]:\n            assert field in data, f\"Missing '{field}' in response\"\n\n        assert isinstance(data[\"id\"], str) and data[\"id\"], \"'id' should be a non-empty string\"\n        assert isinstance(data[\"object\"], str) and data[\"object\"], \"'object' should be a non-empty string\"\n        assert isinstance(data[\"created\"], int) and data[\"created\"] > 0, \"'created' should be a positive integer\"\n        assert isinstance(data[\"model\"], str) and data[\"model\"], \"'model' should be a non-empty string\"\n\n        # Validate 'choices' is a non-empty list\n        choices = data[\"choices\"]\n        assert isinstance(choices, list) and len(choices) > 0, \"'choices' should be a non-empty list\"\n\n        # Each choice should be a dict\n        for choice in choices:\n            assert isinstance(choice, dict), \"Each item in 'choices' should be an object/dict\"\n\n        # usage should be a dict (content not strictly specified)\n        usage = data[\"usage\"]\n        assert isinstance(usage, dict), \"'usage' should be an object/dict\"\n\n        # meta should be a dict (content not strictly specified)\n        meta = data[\"meta\"]\n        assert isinstance(meta, dict), \"'meta' should be an object/dict\"\n\n    except requests.RequestException as e:\n        raise AssertionError(f\"Request to {url} failed: {str(e)}\")\n\ntest_chat_completions_endpoint_returns_openai_compatible_response()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-09T01:14:05.511Z",
    "modified": "2025-11-09T01:14:34.237Z"
  }
]
